steps:
  - label: "Prereqs"
    command: |
      . /etc/profile
      echo $PATH
      nix-shell ops/shell.nix --run just
    key: prereqs

  - label: ":hammer: Build server"
    command: |
      . /etc/profile
      nix-shell ops/shell.nix --run "just build-server"
    key: build-server
    depends_on: prereqs

  - label: ":hammer: Build web"
    command: |
      . /etc/profile
      nix-shell ops/shell.nix --run "just build-web"
    key: build-web
    depends_on: prereqs

  - label: ":hammer: Build images"
    command: |
      . /etc/profile
      nix-shell ops/shell.nix --run "just image-build"
    key: build-images
    depends_on:
      - build-web
      - build-server

  - label: ":test_tube: Test"
    command:
      . /etc/profile
      nix-shell ops/shell.nix --run "just test"
    key: test
    depends_on: build-images

# - label: ":rocket: Deploy"
#   command: "scripts/deploy.sh"
#   key: deploy
#   depends_on: test
